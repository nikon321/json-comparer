<!DOCTYPE html>
<html>
<head>
<title>Test</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="styles/ace.min.css">
<link rel="stylesheet" type="text/css" href="styles/bootstrap.min.css">
<script type="text/javascript" src="scripts/compareJSON.js"></script>
<script type="text/javascript" src="scripts/jquery.js"></script>
<script type="text/javascript" src="scripts/bootstrap.min.js"></script>
<script type="text/javascript" src="scripts/jsrender.min.js"></script>
<script type="text/javascript" src="scripts/jsdiff.js"></script>
<style type="text/css">
.left,
.right {
	float: left;
	width: 50%;
    background-color: rgba(0, 0, 0, 0);
    position: relative;
}
.tree .eq {
    display: none;
}
.left .tree .tree-folder.add .tree-item .tree-item-name,
.left .tree .tree-folder.add .tree-item .tree-item-name {
    font-size: 0;
}
.left .tree .tree-folder.add .tree-item .tree-item-name:before {
    font-size: 14px;
    font-style: italic;
    content: "这里米有数据哦";
}
.left .bg .tree .tree-folder.add .tree-item .tree-item-name:before {
    font-size: 14px;
    content: "";
}
.left .bg .add,
.left .bg .add .tree-item,
.left .bg .add .tree-folder-name,
.right .bg .add,
.right .bg .add .tree-item,
.right .bg .add .tree-folder-name {
    background-color: #CFD;
}
.left .add,
.left .add .tree-item,
.left .add .tree-folder-name,
.left .add span {
    text-decoration: none !important;
}
.right .bg .del,
.right .bg .del .tree-item,
.right .bg .del .tree-folder-name,
.left .bg .del,
.left .bg .del .tree-item,
.left .bg .del .tree-folder-name {
    background-color: #FDD;
}
.right .bg .tree-item.mod,
.left .bg .tree-item.mod {
    background-color: #ddd;
}
.left .bg .tree-folder-header.mod.closed,
.right .bg .tree-folder-header.mod.closed {
    background-color: #ddd;
}
.right .del,
.right .del * {
	color: gray;
	text-decoration: line-through;
}
.left .mod,
.right .mod {
	color: #c9284d;
}
.tree .tree-folder .tree-folder-header:hover,
.tree .tree-item:hover {
    background-color: inherit;
}
.tree .tree-folder:last-child:after {
    left: -14px;
}
.tree .tree-folder.closed .tree-folder-content {
    display: none;
}
/*
* override 背景色
*/
.left .bg,
.right .bg {
	position: absolute;
	top: 8px;
	left: 8px;
	right: 0;
	bottom: 8px;
    background-color: #ffecec;
    z-index: -1;
}
.right .widget-main.padding-8 {
    padding-left: 0;
}
.right .bg {
    left: 0;
}
.bg .tree .tree-folder .tree-folder-content {
	margin-left: 0;
}
.bg .widget-main.padding-8,
.bg .tree {
	padding: 0;
}
.bg .tree:before,
.bg .tree .tree-folder:before,
.bg .tree .tree-item:before,
.bg .tree .tree-folder:last-child:after,
.tree .tree-folder,
.tree .tree-item {
    border: none;
}
.tree {
    margin-left: 8px;
    overflow: hidden;
}
.bg .tree {
    margin-left: 0;
}
.widget-box {
    border: none;
}
.widget-body {
    background-color: rgba(0, 0, 0, 0);
}
.bg .widget-body {
    background-color: #fff;
}
.cliearfix {
    clear: both;
}
/*****************************************************/
.tree .tree-item-name {
    display: inline-block !important;
    *display: inline;
    *zoom: 1;
    max-width: 100%;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
}
#text_compare {
    white-space: pre-wrap;
}
#text_compare pre {
    margin: 0;
    padding: 0;
    border: none;
    background-color: white;
}
#text_compare ins {
    padding: 4px 0;
    text-decoration: none;
    background-color: #CFD;
}
#text_compare del {
    padding: 4px 0;
    text-decoration: none;
    background-color: #FDD;
}
.hide {
    display: none !important;
}
</style>
</head>
<body>
<!-- 
  ** tree_right 
-->
<script type="text/x-jsrender" id="tree_right">
{{if prop.compare_options !== "type_mod"}}
    {{if prop.type === "text" || prop.type === "xml"}}
<div class="tree-item {{:prop.compare_options}}">
	<div class="tree-item-name">
        <i class="ace-icon ace-icon"></i> {{:key}}:
        <span data-path="{{:key}}" class="data-{{:prop.type}} {{:prop.compare_options}}">{{>prop.data}}</span>
    </div>
</div>
    {{else prop.type === "object" || prop.type === "list"}}
<div class="tree-folder {{:prop.compare_options}} {{if prop.compare_options === 'eq' || !prop.compare_options}}closed{{/if}}" data-path="{{:key}}">
    <div class="tree-folder-header">
        <i class="ace-icon {{if prop.compare_options === 'eq' || !prop.compare_options}}tree-plus{{else}}tree-minus{{/if}}" data-icon-path="{{:key}}"></i>
        <div class="tree-folder-name">
            <span style="font-weight: bold">{{:key}}</span>
        </div>
    </div>
    <div class="tree-folder-content">
        {{props prop.data}} {{include tmpl = "#tree_right" /}} {{/props}}
    </div>
</div>
    {{/if}}
{{else}}
    {{if prop.type === "text" || prop.type === "xml"}}
<div class="tree-item add">
    <div class="tree-item-name">
        <i class="ace-icon ace-icon"></i> {{:key}}:
        <span class="data-{{:prop.type}}">{{>prop.data}}</span>
    </div>
</div>
    {{else prop.type === "object" || prop.type === "list"}}
<div class="tree-folder add" data-path="{{:key}}-{{:prop.type}}">
    <div class="tree-folder-header">
        <i class="ace-icon tree-minus" data-icon-path="{{:key}}-{{:prop.type}}"></i>
        <div class="tree-folder-name">
            <span style="font-weight: bold">{{:key}}</span>
        </div>
    </div>
    <div class="tree-folder-content">
        {{props prop.data}} {{include tmpl = "#tree_right" /}} {{/props}}
    </div>
</div>
    {{/if}}

    {{if prop.type1 === "text" || prop.type1 === "xml"}}
<div class="tree-item del">
    <div class="tree-item-name">
        <i class="ace-icon ace-icon"></i> {{:key}}:
        <span class="data-{{:prop.type1}}">{{>prop.data1}}</span>
    </div>
</div>
    {{else prop.type1 === "object" || prop.type1 === "list"}}
<div class="tree-folder del" data-path="{{:key}}-{{:prop.type1}}">
    <div class="tree-folder-header">
        <i class="ace-icon tree-minus" data-icon-path="{{:key}}-{{:prop.type1}}"></i>
        <div class="tree-folder-name">
            <span style="font-weight: bold">{{:key}}</span>
        </div>
    </div>
    <div class="tree-folder-content">
        {{props prop.data1}} {{include tmpl = "#tree_right" /}} {{/props}}
    </div>
</div>
    {{/if}}
{{/if}}
</script>
<script type="text/x-jsrender" id="html_right">
	{{props :}} {{include tmpl = "#tree_right" /}} {{/props}}
</script>
<!-- ******************************************************* -->

<!-- 
  **  tree_left 
-->
<script type="text/x-jsrender" id="tree_left">
{{if prop.compare_options !== "type_mod"}}
    {{if prop.type === "text" || prop.type === "xml"}}
    	{{if prop.compare_options === "mod"}}
<div class="tree-item {{:prop.compare_options}}">
	<div class="tree-item-name">
        <i class="ace-icon ace-icon"></i> {{:key}}:
        <span data-path="{{:key}}" class="data-{{:prop.type}} {{:prop.compare_options}}">{{>prop.data1}}</span>
    </div>
</div>
        {{else prop.compare_options === "add"}}
<div class="tree-item {{:prop.compare_options}}">
    <div class="tree-item-name">
        <i class="ace-icon ace-icon"></i>
        <span><i>这里米有数据哦</i></span>
    </div>
</div>
	   {{else}}
<div class="tree-item {{:prop.compare_options}}">
	<div class="tree-item-name">
        <i class="ace-icon ace-icon"></i> {{:key}}:
        <span class="data-{{:prop.type}}">{{:prop.data}}</span>
    </div>
</div>
        {{/if}}
    {{else prop.type === "object" || prop.type === "list"}}
        {{if prop.compare_options !== "add"}}
<div class="tree-folder {{:prop.compare_options}} {{if prop.compare_options === 'eq' || !prop.compare_options}}closed{{/if}}" data-path="{{:key}}">
    <div class="tree-folder-header">
        <i class="ace-icon {{if prop.compare_options === 'eq' || !prop.compare_options}}tree-plus{{else}}tree-minus{{/if}}" data-icon-path="{{:key}}"></i>
        <div class="tree-folder-name">
            <span style="font-weight: bold">{{:key}}</span>
        </div>
    </div>
    <div class="tree-folder-content">
        {{props prop.data}} {{include tmpl = "#tree_left" /}} {{/props}}
    </div>
</div>
        {{else}}
<div class="tree-folder {{:prop.compare_options}} {{if prop.compare_options === 'eq' || !prop.compare_options}}closed{{/if}}" data-path="{{:key}}">
    <div class="tree-folder-header">
        <i class="ace-icon {{if prop.compare_options === 'eq' || !prop.compare_options}}tree-plus{{else}}tree-minus{{/if}}" data-icon-path="{{:key}}"></i>
        <div class="tree-folder-name">
            <span style="font-weight: bold"><i>这里米有数据哦</i></span>
        </div>
    </div>
    <div class="tree-folder-content">
        {{props prop.data}} {{include tmpl = "#tree_left" /}} {{/props}}
    </div>
</div>
        {{/if}}
    {{/if}}
{{else}}
    {{if prop.type === "text" || prop.type === "xml"}}
<div class="tree-item add">
    <div class="tree-item-name">
        <i class="ace-icon ace-icon"></i>
        <span class="data-{{:prop.type}}"><i>这里米有数据哦</i></span>
    </div>
</div>
    {{else prop.type === "object" || prop.type === "list"}}
<div class="tree-folder add" data-path="{{:key}}-{{:prop.type}}">
    <div class="tree-folder-header">
        <i class="ace-icon {{if prop.compare_options === 'eq' || !prop.compare_options}}tree-plus{{else}}tree-minus{{/if}}" data-icon-path="{{:key}}-{{:prop.type}}"></i>
        <div class="tree-folder-name">
            <span style="font-weight: bold"><i>这里米有数据哦</i></span>
        </div>
    </div>
    <div class="tree-folder-content">
        {{props prop.data}} {{include tmpl = "#tree_left" /}} {{/props}}
    </div>
</div>
    {{/if}}


    {{if prop.type1 === "text" || prop.type1 === "xml"}}
<div class="tree-item del">
    <div class="tree-item-name">
        <i class="ace-icon ace-icon"></i> {{:key}}:
        <span class="data-{{:prop.type1}}">{{>prop.data1}}</span>
    </div>
</div>
    {{else prop.type1 === "object" || prop.type1 === "list"}}
<div class="tree-folder del" data-path="{{:key}}-{{:prop.type1}}">
    <div class="tree-folder-header">
        <i class="ace-icon {{if prop.compare_options === 'eq' || !prop.compare_options}}tree-plus{{else}}tree-minus{{/if}}" data-icon-path="{{:key}}-{{:prop.type1}}"></i>
        <div class="tree-folder-name">
            <span style="font-weight: bold">{{:key}}</span>
        </div>
    </div>
    <div class="tree-folder-content">
        {{props prop.data1}} {{include tmpl = "#tree_left" /}} {{/props}}
    </div>
</div>
    {{/if}}
{{/if}}
</script>
<script type="text/x-jsrender" id="html_left">
	{{props :}} {{include tmpl = "#tree_left" /}} {{/props}}
</script>
<!-- ********************************************************* -->

<!-- 
  ** 背景模板 
-->
<script type="text/x-jsrender" id="tree_bg">
{{if prop.compare_options !== "type_mod"}}
    {{if prop.type === "text" || prop.type === "xml"}}
<div class="tree-item {{:prop.compare_options}}">
	<div class="tree-item-name">
        <i class="ace-icon ace-icon"></i>
        <span class="data-{{:prop.type}}"></span>
    </div>
</div>
    {{else prop.type === "object" || prop.type === "list"}}
<div class="tree-folder {{:prop.compare_options}} {{if prop.compare_options === 'eq' || !prop.compare_options}}closed{{/if}}" data-path="{{:key}}">
    <div class="tree-folder-header {{:prop.compare_options}}">
        <i class="ace-icon hide {{if prop.compare_options === 'eq' || !prop.compare_options}}tree-plus{{else}}tree-minus{{/if}}" data-icon-path="{{:key}}"></i>
        <div class="tree-folder-name">
            <span style="font-weight: bold"></span>
        </div>
    </div>
    <div class="tree-folder-content">
        {{props prop.data}} {{include tmpl = "#tree_bg" /}} {{/props}}
    </div>
</div>
    {{/if}}
{{else}}
    {{if prop.type === "text" || prop.type === "xml"}}
<div class="tree-item add">
    <div class="tree-item-name">
        <i class="ace-icon ace-icon"></i>
        <span class="data-{{:prop.type}}"></span>
    </div>
</div>
    {{else prop.type === "object" || prop.type === "list"}}
<div class="tree-folder add" data-path="{{:key}}-{{:prop.type}}">
    <div class="tree-folder-header add">
        <i class="ace-icon hide tree-minus" data-icon-path="{{:key}}-{{:prop.type}}"></i>
        <div class="tree-folder-name">
            <span style="font-weight: bold"></span>
        </div>
    </div>
    <div class="tree-folder-content">
        {{props prop.data}} {{include tmpl = "#tree_bg" /}} {{/props}}
    </div>
</div>
    {{/if}}

    {{if prop.type1 === "text" || prop.type1 === "xml"}}
<div class="tree-item del">
    <div class="tree-item-name">
        <i class="ace-icon ace-icon"></i>
        <span class="data-{{:prop.type1}}"></span>
    </div>
</div>
    {{else prop.type1 === "object" || prop.type1 === "list"}}
<div class="tree-folder del" data-path="{{:key}}-{{:prop.type1}}">
    <div class="tree-folder-header del">
        <i class="ace-icon hide tree-minus" data-icon-path="{{:key}}-{{:prop.type1}}"></i>
        <div class="tree-folder-name">
            <span style="font-weight: bold"></span>
        </div>
    </div>
    <div class="tree-folder-content">
        {{props prop.data1}} {{include tmpl = "#tree_bg" /}} {{/props}}
    </div>
</div>
    {{/if}}
{{/if}}
</script>
<script type="text/x-jsrender" id="html_bg">
	{{props :}} {{include tmpl = "#tree_bg" /}} {{/props}}
</script>
<!-- ********************************************************* -->

<div id="text_compare_modal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body" id="text_compare">
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>


<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<button id="bu">Full Screen</button>
<div id="main-con">
	<div class="left">
		<div class="widget-box widget-color-blue2">
            <div class="widget-body">
                <div class="widget-main padding-8">
                    <div class="tree tree-selectable" id="tree_left_con">
                        <!-- <section ng-repeat="(k, v) in data" ng-include="'tree'" onload="afterRender()"></section> -->
                    </div>
                </div>
            </div>
        </div>

		<div class="widget-box widget-color-blue2 bg">
            <div class="widget-body">
                <div class="widget-main padding-8">
                    <div class="tree tree-selectable" id="tree_left_bg_con">
                        <!-- <section ng-repeat="(k, v) in data" ng-include="'tree'" onload="afterRender()"></section> -->
                    </div>
                </div>
            </div>
        </div>
	</div>
	<div class="right">
		<div class="widget-box widget-color-blue2">
            <div class="widget-body">
                <div class="widget-main padding-8">
                    <div class="tree tree-selectable" id="tree_right_con">
                        <!-- <section ng-repeat="(k, v) in data" ng-include="'tree'" onload="afterRender()"></section> -->
                    </div>
                </div>
            </div>
        </div>


		<div class="widget-box widget-color-blue2 bg">
            <div class="widget-body">
                <div class="widget-main padding-8">
                    <div class="tree tree-selectable" id="tree_right_bg_con">
                        <!-- <section ng-repeat="(k, v) in data" ng-include="'tree'" onload="afterRender()"></section> -->
                    </div>
                </div>
            </div>
        </div>
	</div>
    <div class="cliearfix"></div>
</div>
<script type="text/javascript">
// obj.test = {};
// obj.test.data = obj.data;
// obj.test.type = obj.type;
var text_bg = $.templates("#html_bg").render(obj);
var text_right = $.templates("#html_right").render(obj);
var text_left = $.templates("#html_left").render(obj);

$("#tree_right_con").html(text_right);
$("#tree_left_con").html(text_left);
$("#tree_left_bg_con, #tree_right_bg_con").html(text_bg);

$(".tree-minus, .tree-plus").bind("click", function(event) {
    var $this = $(this),
        path = getPath($this),
        eles_sl = "",
        type = "minus";
    if($this.hasClass("tree-plus")) {
        type = "plus";
    }
    eles_sl += ".left " + path  + " [data-icon-path='" + $this.attr("data-icon-path") + "']";
    eles_sl += ", .right " + path  + " [data-icon-path='" + $this.attr("data-icon-path") + "']";
    $(eles_sl).parent().toggleClass("closed").next().toggle("hide");
    if(type === "minus") $(eles_sl).removeClass("tree-minus").addClass("tree-plus");
    else if(type === "plus") $(eles_sl).removeClass("tree-plus").addClass("tree-minus");
});

$("#bu").bind("click", function(event) {
    $(this).remove();
    $("#main-con").css({
        "position": "fixed",
        "left": 0,
        "right": 0,
        "top": 0,
        "bottom": 0,
        "overflow": "auto"
    });
});

$(".data-text.mod").bind("click", function(event) {
    var $this = $(this),
        path = getPath($this),
        sl_left = ".left " + path + " [data-path='" + $this.attr("data-path") + "']",
        sl_right = ".right " + path + " [data-path='" + $this.attr("data-path") + "']",
        text_left = $(sl_left).eq(0).text(),
        text_right = $(sl_right).eq(0).text(),
        diff_type = "diffWords",
        html = "",
        diff = JsDiff[diff_type](text_right, text_left);
    diff.forEach(function(val, index, ary) {
        if(val.added) html += "<ins>" + val.value + "</ins>";
        else if(val.removed) html += "<del>" + val.value + "</del>";
        else html += val.value;
    });
    $("#text_compare").html(html);
    $("#text_compare_modal").modal();
});

$(".data-xml").bind("click", function(event) {
    var $this = $(this),
        path = getPath($this),
        sl_left = ".left " + path + " [data-path='" + $this.attr("data-path") + "']",
        sl_right = ".right " + path + " [data-path='" + $this.attr("data-path") + "']",
        text_left = formatXml($(sl_left).eq(0).text()),
        text_right = formatXml($(sl_right).eq(0).text()),
        diff_type = "diffWords",
        html = "",
        diff = JsDiff[diff_type](text_right, text_left);
    diff.forEach(function(val, index, ary) {
        if(val.added) html += "<ins>" + val.value + "</ins>";
        else if(val.removed) html += "<del>" + val.value + "</del>";
        else html += val.value;
    });
    $("#text_compare").html("<pre>" + html + "</pre>");
    $("#text_compare_modal").modal();
});
</script>
</body>
</html>